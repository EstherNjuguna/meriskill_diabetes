---
title: "R Notebook"
output:
  html_document:
    fig_width: 7
    fig_height: 5
---

```{r echo=FALSE}
 library(readr)
 library(purrr)
 library(ggplot2)
 library(dplyr)
 library(tidyr)
 library(corrplot)
library(rmarkdown)
```

## Introduction

This dataset is originally from the National Institute of Diabetes and Digestive and Kidney Diseases. The objective is to predict based on diagnostic measurements whether a patient has diabetes.

## Data Dictionary

Several constraints were placed on the selection of these instances from a larger database. In particular, all patients here are females at least 21 years old of Pima Indian heritage.

-   Pregnancies: Number of times pregnant

-   Glucose: Plasma glucose concentration a 2 hours in an oral glucose tolerance test

-   BloodPressure: Diastolic blood pressure (mm Hg)

-   SkinThickness: Triceps skin fold thickness (mm)

-   Insulin: 2-Hour serum insulin (mu U/ml)

-   BMI: Body mass index (weight in kg/(height in m)\^2)

-   DiabetesPedigreeFunction: Diabetes pedigree function. Indicates the function which scores likelihood of diabetes based on family history

-   Age: Age (years)

-   Outcome: Class variable (0 or 1). If patient had diabetes 1 = Yes, 0 = No.

## Understand the data

The data was imported into R and run head to visualize the first 6 rows

```{r echo=FALSE}
 diabetes <- read.csv("~/data_analytics/meriskill_diabetes/diabetes.csv")
  head(diabetes)
   summary(diabetes)
```

Also looked at the dimensions of the data. The dataset had 768 rows and 9 columns

```{r}
dim(diabetes)
```

```{r}
colnames(diabetes)
```

Looking if we had any null values in the data or any duplicated values. No null values were present.

```{r echo=FALSE}
diabetes %>% map(~sum(is.na(.)))
# duplicated
 sum(duplicated(diabetes))
```

```{}
```

Since We cannot have Bps, BMI, Skin Thickness and Glucose being zero(0) all zero values were replaced with the mean/median since dropping them would change the data.

```{r echo=FALSE}

diabetes <- diabetes %>%
  mutate(BloodPressure = ifelse(BloodPressure == 0, mean(BloodPressure, na.rm = TRUE), BloodPressure))
  
# Replace 0 BMI with mean
diabetes <- diabetes %>%
  mutate(BMI = replace(BMI, BMI == 0, mean(BMI, na.rm = TRUE)))

# Replace 0 glucose levels
diabetes <- diabetes %>%
  mutate(Glucose = replace(Glucose, Glucose == 0, mean(Glucose, na.rm = TRUE)))

# Replace 0 skin Thickness
diabetes <- diabetes %>%
  mutate(SkinThickness = replace(SkinThickness, SkinThickness == 0, mean(SkinThickness, na.rm = TRUE)))
# Insulin
diabetes <- diabetes %>%
  mutate(Insulin = replace(Insulin, Insulin == 0, median(Insulin, na.rm = TRUE)))
# Age Categorization
 diabetes <- diabetes %>%
   mutate(
     age_cat = case_when(
       Age >= 21 & Age <= 29 ~ 'Below_30',
       Age >= 30 & Age <= 39 ~ '30s',
       Age >= 40 & Age <= 49 ~ '40s',
       Age >= 50 & Age <= 59 ~ '50s',
       Age >= 60 & Age <= 69 ~ '60s',
       Age >= 70 ~ 'Above_70',
       TRUE ~ 'Unknown'  # Default category for other cases
     
   ))
 # View the resulting dataset

 summary(diabetes)
 
 
```

## Insights

### How was the population spread?

| age_cat  | Percent |     |     |     |
|:---------|--------:|-----|-----|-----|
| Below_30 |   51.56 |     |     |     |
| 30s      |   21.48 |     |     |     |
| 40s      |   15.36 |     |     |     |
| 50s      |    7.42 |     |     |     |
| 60s      |    3.78 |     |     |     |
| Above_70 |    0.39 |     |     |     |

```{r , echo = FALSE}
 ## categorize age vs the outcome

 ggplot(diabetes, aes(x = age_cat)) +
   geom_bar(fill = "blue") +
   labs(
     title = "Distribution across Age Categories",
     x = " ",
     y = ""
   ) +
  
   theme_minimal()+
   theme(
    panel.grid.major = element_blank(),  # Hide major grid lines
    panel.grid.minor = element_blank(),  # Hide minor grid lines
    axis.text.x = element_text(angle = 0, hjust = 0.5)  # Adjust x-axis label alignment
  )
```

```{r eval=FALSE, include=FALSE}
grouped_ages <- diabetes %>%
  group_by(age_cat) %>%
  summarize(Percent = n() / nrow(diabetes) * 100) %>%
  mutate(Percent = round(Percent, 2)) %>%
  arrange(desc(Percent))

grouped_ages

```

### Number of Pregnancies

The mean number of pregnancies was around 3 with the data being skewed to the left. A few extremes having above 11 pregnancies accounting for 4.43%

```{r eval=FALSE, include=FALSE}
number <- diabetes %>%
  filter(Pregnancies > 10)%>%
  summarize(Percent = n() / nrow(diabetes) * 100) %>%
  mutate(Percent = round(Percent, 2)) %>%
  arrange(desc(Percent))
number
```

```{r echo=FALSE}
ggplot(diabetes, aes(Pregnancies,fill= "blue"))+
  geom_histogram(binwidth = 2)+
   labs(
    title = "Number of Pregnancies",
    y ="",
    x =""
  ) +
  scale_fill_manual(values = c("blue" = "blue"))+
   theme(
    panel.grid.major = element_blank(),  # Hide major grid lines
    panel.grid.minor = element_blank(),  # Hide minor grid lines
    axis.text.x = element_text(angle = 0, hjust = 0.5)  # Adjust x-axis label alignment
  )
```

### Comparison of pregnancies and outcome

Those who had higher number of pregnancies had a higher chance of being diabetic.

```{r}
ggplot(diabetes, aes(Pregnancies, Outcome))+
geom_boxplot() +
labs(
    title = "Comparison of pregnancies and outcome",
    x = "",
    y = ""
  ) 

```

```{undefined eval=FALSE, include=FALSE}
```

### BMI numbers

About 61.98 % of the population had a BMI of above 30 which is considered as being obese. 1.04% had a BMI of above 50 which even though possible could be an outlier. 0.52% percent of the population were underweight with a BMI \< 18.5

```{r echo=FALSE}
diabetes <- diabetes %>%
  mutate(
    BMI_cat = case_when(
      BMI < 18.5 ~ 'Underweight',
      BMI >= 18.5 & BMI < 25 ~ 'Normal',
      BMI >= 25 & BMI < 30 ~ 'Obese',
      BMI >= 30 & BMI < 35 ~ 'Moderate Obese',
      BMI >= 35 & BMI < 40 ~ 'Severe Obese',
      BMI >= 40 & BMI < 45 ~ 'Very severe Obese',
      BMI >= 45 & BMI < 50 ~ 'Morbid Obese',
      BMI >= 50 & BMI <= 60 ~ 'Super Obese',
      BMI > 60 ~ 'Hyper obese',
      TRUE ~ 'Unknown'  # Default category for other cases
    )
  )

# View the resulting dataset
grouped_counts <- diabetes %>%
  group_by(BMI_cat) %>%
   summarize(Percent = n() ) %>%
  arrange(desc(Percent))
grouped_counts
```

```{r eval=FALSE, include=FALSE}
number <- diabetes %>%
  filter(BMI > 50) %>%

  summarize(Percent = n() / nrow(diabetes) * 100) %>%
  mutate(Percent = round(Percent, 2)) %>%
  arrange(desc(Percent))
number
```

```{r echo=FALSE}
ggplot(diabetes, aes(BMI)) +
  geom_histogram(binwidth = 2) +
  labs(
    title = "Histogram of Outcome by BMI",
    x = " ",
    y = ""
  ) +
  facet_wrap(~Outcome)


```

### Diabetes pedigree Function and BMI

The super Obese, Severe Obese and very severe obese had the highest diabetes pedigree function. This in itself is not a good measure since even the underweight still have a high DPF

```{r echo=FALSE}
ggplot(diabetes, aes(BMI_cat, y = DiabetesPedigreeFunction)) +
  geom_bar(stat = "summary", fun = "mean",fill = "blue") +
  labs(
    title = "Bar Plot of DPF by BMI Category",
    x = "",
    y = ""
  ) +
  theme_minimal()+
  theme(
    panel.grid.major = element_blank(),  # Hide major grid lines
    panel.grid.minor = element_blank(),  # Hide minor grid lines
    axis.text.x = element_text(angle = 0, hjust = 0.5)  # Adjust x-axis label alignment
  )

```

### Glucose ranges

Those with Glucose above 125 classified as hypergylcemia accounted for 40.49 %, Impaired glucose had 34.5% while the hypoglycemia accounted for 1%

```{r}
diabetes <- diabetes %>%
  mutate(
    glucose_range = case_when(
      Glucose <70 ~ 'Hypoglycemia',
      Glucose >= 70 & Glucose < 100 ~ 'Normal',
      Glucose >= 100 & Glucose < 125 ~ 'Impaired Glucose',
      Glucose >= 125 ~ 'Hypergylcemia',
      TRUE ~ 'Unknown'  # Default category for other cases
    )

  )
 ggplot(diabetes, aes(x = glucose_range)) +
   geom_bar(fill = "blue") +
   labs(
     title = "Glucose Ranges",
     x = " ",
     y = ""
   ) +
  
   theme_minimal()+
   theme(
    panel.grid.major = element_blank(),  # Hide major grid lines
    panel.grid.minor = element_blank(),  # Hide minor grid lines
    axis.text.x = element_text(angle = 0, hjust = 0.5)  # Adjust x-axis label alignment
  )
 
```

```{r eval=FALSE, include=FALSE}
sugars <- diabetes %>%
  group_by(glucose_range) %>%
  summarize(Percent = n()/ nrow(diabetes) * 100) %>%
  arrange(desc(Percent)) 
sugars

```

### Glucose Ranges and Diabetes Pedigree Function

Both the hyperglycemia and impaired glucose had the highest diabetes pedigree function.

```{r echo=FALSE}
ggplot(diabetes, aes(glucose_range, y = DiabetesPedigreeFunction)) +
  geom_bar(stat = "summary", fun = "mean",fill = "blue") +
  labs(
    title = "Bar Plot of DPF by Glucose Ranges",
    x = "",
    y = ""
  ) +
  theme_minimal()+
  theme(
    panel.grid.major = element_blank(),  # Hide major grid lines
    panel.grid.minor = element_blank(),  # Hide minor grid lines
    axis.text.x = element_text(angle = 0, hjust = 0.5)  # Adjust x-axis label alignment
  )

```

The patient with hyperglycemia or high glucose 2 hours after Oral glucose test had a higher chance of having diabetes as their outcome. Compared to the hypoglycemic who none had diabetes as the outcome.

```{r}
ggplot(diabetes, aes(x = glucose_range, fill = Outcome)) +
   geom_bar() +
   labs(
     title = "Glucose Range vs. Outcome",
     x = " ",
     y = " "
   ) +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +  
   theme_minimal()+
   theme(
    panel.grid.major = element_blank(),  # Hide major grid lines
    panel.grid.minor = element_blank(),  # Hide minor grid lines
    axis.text.x = element_text(angle = 0, hjust = 0.5)  # Adjust x-axis label alignment
  )
```

### How do the various paramaters relate to each other

```{r echo=FALSE}
 diabetes_numeric <- diabetes[, c("Pregnancies", "Age","DiabetesPedigreeFunction",  "Outcome","BMI", "BloodPressure", "Glucose", "Insulin", "SkinThickness")]
 
 # Calculate the correlation matrix
 correlation_matrix <- cor(diabetes_numeric)
 
 corrplot(
   correlation_matrix ,
   method = "color", 
   col = colorRampPalette(c("red", "white", "blue"))(100),# Use color to represent correlations
   type = "upper",    # Show only the upper triangle of the matrix
   tl.col = "black",  # Label color
   tl.srt = 45,       # Label rotation angle
   tl.pos = "lt",   # Label position
   diag = FALSE,      # Exclude the diagonal
   addCoef.col = "black",  # Color of correlation coefficients
   tl.cex = 0.7       # Label text size
 )
```

```{r}
diabetes$Outcome <- factor(diabetes$Outcome, levels = c(1, 0), labels = c("Yes", "No"))

ggplot(diabetes, aes(x = Outcome, fill = Outcome)) +
  geom_bar() +  # Create the bar plot
  labs(
    title = "Distribution of Outcome",
    y = NULL
  ) +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +  # Set bar colors
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  # Hide major grid lines
    panel.grid.minor = element_blank(),  # Hide minor grid lines
    axis.text.x = element_text(angle = 0, hjust = 0.5)  # Adjust x-axis label alignment
  )

```

## comparison of age and outcome

```{r}
 ggplot(diabetes, aes(x = age_cat, fill = Outcome)) +
   geom_bar() +
   labs(
     title = "Age Category vs. Outcome",
     x = " ",
     y = ""
   ) +
scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +  
   theme_minimal()+
   theme(
    panel.grid.major = element_blank(),  # Hide major grid lines
    panel.grid.minor = element_blank(),  # Hide minor grid lines
    axis.text.x = element_text(angle = 0, hjust = 0.5)  # Adjust x-axis label alignment
  )
```
